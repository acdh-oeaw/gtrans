{% extends "webpage/base.html" %}
{% load staticfiles %}
{% load stats_extras %}
{% load webpage_extras %}
{% load news_extras %}
{% block scriptHeader %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spin.js/2.3.2/spin.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/wordcloud.js"></script>
{% endblock scriptHeader %}
{% block content %}

        <div class="jumbotron" style="background-image: url({% static 'webpage/img/project_background.jpg' %}) ">
            <div class="container">
                <h1 style="text-align:center">{% projects_metadata 'title' %}</h1>
                <h3 style="text-align:center">{% projects_metadata 'subtitle' %}</h3>
                <h5 style="text-align:center">{% projects_metadata 'description' %}</h5>
                    <p>
                        WSTLA, MD 8093, 1918-22, foto by Veronika Helfert
                    </p>
                    <p>
                        <a class="btn btn-main btn-outline-primary btn-lg" href="{% url 'archiv:archresource_browse' %}" role="button">Alle Dokumente</a>
                        <a class="btn btn-main btn-outline-primary btn-lg" href="{% url 'archiv:schlagworte' %}" role="button">Schlagwortliste</a>
                    </p>
            </div>
        </div>

    <div class="container">
        {% newsfeed_bootstrap_panel %}<br>
        <div class="row">
            <div class="col-md-12">
                <h5 class="row-heading pb-2 mb-3 border-bottom"><i class="fas fa-paste"></i> Data-Count</h5>
            </div>

            {% create_object_count app='archiv' as models %}
            {% for x in models %}
                <div class="col-md-12  text-center">
                    <div class="card flex-md-row mb-4 box-shadow">
                        <div class="card-body">
                            <h4 class="mb-0">{{x.name}}</h4>
                            <h4 class="count">{{ x.count }}</h4>
                            {% if x.link %}
                                <a class="btn btn-main btn-outline-primary btn-sm" href="{{ x.link }}" role="button">View Details</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
            <hr />
            {% create_object_count app='entities' as models %}
            {% for x in models %}
                <div class="col-md-4  text-center">
                    <div class="card flex-md-row mb-4 box-shadow">
                        <div class="card-body">
                            <h4 class="mb-0">{{x.name}}</h4>
                            <h4 class="count">{{ x.count }}</h4>
                            {% if x.link %}
                                <a class="btn btn-main btn-outline-primary btn-sm" href="{{ x.link }}" role="button">View Details</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Schlagworte</h3>
                    </div>
                    <div class="card-body">
                        <div id="wordcloud" style="position: relative; height: 600px; background: #fafafa;"></div>
                    </div>
                </div>
                <script type="text/javascript">
                    const my_wcloud = document.getElementById('wordcloud')
                    var spinner = new Spinner().spin();
                    my_wcloud.appendChild(spinner.el);
                    fetch("{% url 'archiv:subject-cloud' %}")
                      .then(response => response.json())
                      .then((data) => {
                        // jsonData is parsed json object received from url
                        console.log(data)
                        Highcharts.chart(my_wcloud, {
                            series: [{
                                type: 'wordcloud',
                                data: data,
                                name: 'Occurrences',
                                // spiral: 'archimedean'
                            }],
                            title: false
                        });
                      })
                      .catch((error) => {
                        // handle your errors here
                        console.error(error)
                      })
                    // const graph = JSON.parse(document.getElementById('netviz-data').textContent);

                </script>
            </div>

            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Abstracts</h3>
                    </div>
                    <div class="card-body">
                        <div id="wordcloud_1" style="position: relative; height: 600px; background: #fafafa;"></div>
                    </div>
                </div>
                <script type="text/javascript">
                    const my_wcloud_1 = document.getElementById('wordcloud_1')
                    var spinner = new Spinner().spin();
                    my_wcloud_1.appendChild(spinner.el);
                    fetch("{% url 'wordcloud:all_words' app_name='archiv' model_name='archresource' field_name='abstract' %}")
                      .then(response => response.json())
                      .then((data) => {
                        // jsonData is parsed json object received from url
                        console.log(data)
                        Highcharts.chart(my_wcloud_1, {
                            series: [{
                                type: 'wordcloud',
                                data: data,
                                name: 'Occurrences',
                                // spiral: 'archimedean'
                            }],
                            title: false
                        });
                      })
                      .catch((error) => {
                        // handle your errors here
                        console.error(error)
                      })
                    // const graph = JSON.parse(document.getElementById('netviz-data').textContent);

                </script>
            </div>
        </div>
    </div>
{% endblock %}
